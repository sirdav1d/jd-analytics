generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Organization {
  id                 String   @id @default(uuid())
  name               String
  googleAccessToken  String?
  googleRefreshToken String?
  googleScopes       String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  googleExpiresAt    BigInt?
  external_code      Int      @unique @default(autoincrement()) @db.SmallInt
  Pedido             Pedido[]
}

model User {
  id         String      @id @default(uuid())
  name       String
  email      String      @unique
  password   String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime    @updatedAt
  role       Role
  externalId String      @unique
  Pedidos    Pedido[]
  SalesGoal  SalesGoal[]
  isActive   Boolean     @default(true)
}

model Customer {
  id           String     @id @default(uuid())
  name         String
  personType   PersonType @map("person_type")
  externalCode Int?       @unique
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  sales        Pedido[]
}

model SalesGoal {
  id          String   @id @default(uuid())
  userId      String
  goalDateRef DateTime @db.Date
  revenue     Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  seller      User     @relation(fields: [userId], references: [id])

  @@unique([userId, goalDateRef])
}

model RoasGoal {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  goalDateRef DateTime @unique @db.Date // garante um ROAS por mÃªs
  roas        Int
}

model PaymentMethod {
  id        String   @id @default(uuid())
  method    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sales     Pedido[]
}

model SaleItem {
  id         String   @id @default(uuid())
  quantity   Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  productId  String   @map("product_id")
  saleId     String   @map("sale_id")
  totalValue Float    @map("total_value")
  unitValue  Float    @map("unit_value")
  product    Product  @relation(fields: [productId], references: [id])
  sale       Pedido   @relation(fields: [saleId], references: [id], onDelete: Cascade)
}

model Product {
  id            String     @id @default(uuid())
  description   String
  brand         String
  sector        String
  external_code Int?       @unique(map: "Product_externalCode_key")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  items         SaleItem[]
}

model Pedido {
  id              String         @id @default(uuid())
  data_pedido     DateTime       @db.Date
  natureOperation String
  operationType   String
  documentNumber  String
  origin_linx     String
  cancelled       Boolean        @default(false)
  userId          String
  customerId      String?
  paymentMethodId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  organizationId  String
  originId        String?        @default(dbgenerated("'941a73ef-4b63-4972-b77c-0f6f14962be9'::uuid")) @map("origin_id") @db.Uuid
  customer        Customer?      @relation(fields: [customerId], references: [id])
  organization    Organization   @relation(fields: [organizationId], references: [id])
  paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])
  user            User           @relation(fields: [userId], references: [id])
  items           SaleItem[]
  Origin          Origin?        @relation(fields: [originId], references: [id])

  @@unique([documentNumber, organizationId, data_pedido])
}

model Origin {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  created_at DateTime  @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamp(6)
  name       String    @unique
  pedidos    Pedido[]
}

enum Role {
  ADMIN
  MANAGER
  SELLER
}

enum PersonType {
  FISICA
  JURIDICA
}
